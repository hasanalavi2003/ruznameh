<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ² â€” pishkhan.com</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(90deg, #2c3e50, #4a6491);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .card {
            margin-bottom: 20px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-radius: 10px;
            overflow: hidden;
            height: 100%;
        }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            }

        .card-img-top {
            cursor: pointer;
            height: 220px;
            object-fit: cover;
            transition: transform 0.3s;
            background: linear-gradient(45deg, #f5f5f5 25%, #e0e0e0 25%, #e0e0e0 50%, #f5f5f5 50%, #f5f5f5 75%, #e0e0e0 75%, #e0e0e0);
            background-size: 20px 20px;
        }

            .card-img-top:hover {
                transform: scale(1.02);
            }

        .modal-xl {
            max-width: 95%;
        }

        .countdown {
            font-size: 1.2rem;
            color: #d9534f;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
            border: 1px solid #ffeaa7;
        }

        .hidden {
            display: none !important;
        }

        .date-input-container {
            max-width: 400px;
            margin: 0 auto 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
        }

        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .pdf-iframe {
            width: 100%;
            height: 0;
            border: none;
            transition: height 0.5s ease;
            display: block;
            border-radius: 5px;
        }

            .pdf-iframe.loaded {
                height: 80vh;
                min-height: 500px;
                max-height: 800px;
            }

        .btn-primary {
            background: linear-gradient(90deg, #3498db, #2980b9);
            border: none;
            padding: 8px 16px;
        }

        .badge {
            font-size: 0.8em;
            padding: 4px 8px;
        }

        .available-badge {
            background: #28a745;
        }

        .unavailable-badge {
            background: #6c757d;
        }

        .stats {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .image-placeholder {
            width: 100%;
            height: 220px;
            background: linear-gradient(45deg, #f0f0f0 25%, #e0e0e0 25%, #e0e0e0 50%, #f0f0f0 50%, #f0f0f0 75%, #e0e0e0 75%, #e0e0e0);
            background-size: 20px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }

        .retry-btn {
            margin-top: 10px;
        }

        .speed-optimized {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .newspaper-count {
            font-weight: bold;
            color: #d32f2f;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header text-center">
            <h1><i class="fas fa-newspaper me-2"></i>Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ² â€” Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±Ø¹Øª</h1>
            <p class="mb-0">Ù†Ù…Ø§ÛŒØ´ Ø³Ø±ÛŒØ¹ ØªÙ…Ø§Ù… Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†ÛŒ Ø§Ø² pishkhan.com</p>
        </div>

        <div class="date-input-container">
            <div class="speed-optimized">
                <i class="fas fa-bolt me-2"></i>
                <small>Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ â€” Ø¨Ø±Ø±Ø³ÛŒ <span class="newspaper-count">80+</span> Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² 20 Ø«Ø§Ù†ÛŒÙ‡</small>
            </div>

            <label for="jalaliDate" class="form-label fw-bold mt-2">
                <i class="fas fa-calendar-alt me-2"></i>Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ®
            </label>
            <div class="input-group">
                <input type="text"
                       id="jalaliDate"
                       class="form-control text-center"
                       placeholder="1404/10/08"
                       value="1404/10/08" />
                <button class="btn btn-primary" onclick="loadNewspapers()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <small class="form-text text-muted">Ù…Ø«Ø§Ù„: 1404/10/08 (Ù¾Ø±Ø¨Ø§Ø²Ø¯ÛŒØ¯ØªØ±ÛŒÙ† ØªØ§Ø±ÛŒØ® â€” Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ† Ù„ÙˆØ¯)</small>
        </div>

        <div id="stats" class="stats text-center"></div>

        <div id="status" class="loading">
            <i class="fas fa-spinner fa-spin me-2"></i>Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§...
        </div>

        <div id="newspaperCards" class="row"></div>
    </div>

    <!-- Image Zoom Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="imageContainer" style="min-height: 500px; display: flex; align-items: center; justify-content: center;">
                        <img id="modalImage" src="" class="img-fluid rounded" style="max-height: 80vh;" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Viewer Modal -->
    <div class="modal fade" id="pdfModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ú©Ø§Ù…Ù„</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="countdownContainer" class="text-center countdown">
                        <i class="fas fa-hourglass-half me-2"></i>
                        <span>Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</span>
                    </div>
                    <iframe id="pdfFrame" class="pdf-iframe"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ global
        const dateInput = document.getElementById('jalaliDate');
        const cardsContainer = document.getElementById('newspaperCards');
        const statusEl = document.getElementById('status');
        const statsEl = document.getElementById('stats');
        let newspapersCache = {}; // Ú©Ø´ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®

        // ÙØ±Ù…Øªâ€ŒÚ©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ® (Ø­Ø°Ù Ø§Ø³Ù„Ø´)
        function formatDate(shamsiDate) {
            return shamsiDate.replace(/\//g, '');
        }

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
        function isValidJalaliDate(dateStr) {
            const regex = /^(\d{4})\/(0?[1-9]|1[0-2])\/(0?[1-9]|[12]\d|3[01])$/;
            return regex.test(dateStr);
        }

        // Ø§ÛŒØ¬Ø§Ø¯ URL ØªØµÙˆÛŒØ± Ø¯Ø±Ø³Øª
        function createCorrectImageUrl(latinName, dateFormatted) {
            const year = dateFormatted.substring(0, 4);
            const month = dateFormatted.substring(4, 6);
            return `https://www.pishkhan.com/Archive/${year}/${month}/${dateFormatted}/${latinName}.jpg`;
        }

        // Ø§ÛŒØ¬Ø§Ø¯ URL PDF
        function createPdfUrl(latinName, dateFormatted) {
            return `https://www.pishkhan.com/pdfviewer.php?paper=${latinName}&date=${dateFormatted}`;
        }

        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªØµÙˆÛŒØ± Ø¨Ø§ timeout Ú©ÙˆØªØ§Ù‡
        async function checkImageExists(url) {
            return new Promise((resolve) => {
                const img = new Image();
                let loaded = false;

                img.onload = () => {
                    if (!loaded) {
                        loaded = true;
                        resolve(true);
                    }
                };

                img.onerror = () => {
                    if (!loaded) {
                        loaded = true;
                        resolve(false);
                    }
                };

                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† timestamp Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø´
                const cacheBustUrl = url;// + '?t=' + Date.now();

                // ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ú©ÙˆØªØ§Ù‡: 1.5 Ø«Ø§Ù†ÛŒÙ‡
                setTimeout(() => {
                    if (!loaded) {
                        loaded = true;
                        resolve(false);
                    }
                }, 1500);

                img.src = cacheBustUrl;
            });
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ - Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        async function fetchNewspapersOptimized(dateFormatted) {
            const cacheKey = dateFormatted;

            // Ø§Ú¯Ø± Ø¯Ø± Ú©Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø¨ÙˆØ¯ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†
            if (newspapersCache[cacheKey]) {
                console.log('ğŸ“¦ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©Ø´ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§');
                return newspapersCache[cacheKey];
            }

            statusEl.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ø¯Ø±ÛŒØ§ÙØª Ø³Ø±ÛŒØ¹ Ù„ÛŒØ³Øª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§...';

            try {
                // Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø³Ø§ÛŒØª (Ø§Ø² Ú©Ø¯ HTML Ú©Ù‡ Ø¯Ø§Ø¯ÛŒ)
                const newspapers = [
                    { latin: 'ArmanRavabetOmoomi', persian: 'Ø¢Ø±Ù…Ø§Ù† Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'ArmanMeli', persian: 'Ø¢Ø±Ù…Ø§Ù† Ù…Ù„ÛŒ', hasPdf: true },
                    { latin: 'Asia', persian: 'Ø¢Ø³ÛŒØ§', hasPdf: true },
                    { latin: 'Agaah', persian: 'Ø¢Ú¯Ø§Ù‡', hasPdf: true },
                    { latin: 'AbrarNews', persian: 'Ø§Ø¨Ø±Ø§Ø±', hasPdf: true },
                    { latin: 'AbrarEghtesadi', persian: 'Ø§Ø¨Ø±Ø§Ø± Ø§Ù‚ØªØµØ§Ø¯ÛŒ', hasPdf: true },
                    { latin: 'AtrakDaily', persian: 'Ø§ØªØ±Ú©', hasPdf: true },
                    { latin: 'AkhbarSanat', persian: 'Ø§Ø®Ø¨Ø§Ø± ØµÙ†Ø¹Øª', hasPdf: true },
                    { latin: 'Azarbaydgan', persian: 'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù†', hasPdf: true },
                    { latin: 'Etedal', persian: 'Ø§Ø¹ØªØ¯Ø§Ù„', hasPdf: true },
                    { latin: 'Etemaad', persian: 'Ø§Ø¹ØªÙ…Ø§Ø¯', hasPdf: true },
                    { latin: 'Eskenas', persian: 'Ø§Ø³Ú©Ù†Ø§Ø³', hasPdf: true },
                    { latin: 'EsfahanEmrooz', persian: 'Ø§ØµÙÙ‡Ø§Ù† Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'Afkar', persian: 'Ø§ÙÚ©Ø§Ø±', hasPdf: true },
                    { latin: 'EqtesadAyandeh', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ø¢ÛŒÙ†Ø¯Ù‡', hasPdf: true },
                    { latin: 'EghtesadPooya', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ù¾ÙˆÛŒØ§', hasPdf: true },
                    { latin: 'EghtesadSaramad', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ø³Ø±Ø¢Ù…Ø¯', hasPdf: true },
                    { latin: 'EghtesadKish', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ú©ÛŒØ´', hasPdf: true },
                    { latin: 'EghtesadeMardom', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ù…Ø±Ø¯Ù…', hasPdf: true },
                    { latin: 'EghtesadeMeli', persian: 'Ø§Ù‚ØªØµØ§Ø¯ Ù…Ù„ÛŒ', hasPdf: true },
                    { latin: 'Emrooz', persian: 'Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'Eidehrooz', persian: 'Ø§ÛŒØ¯Ù‡ Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'BakhtarDaily', persian: 'Ø¨Ø§Ø®ØªØ±', hasPdf: true },
                    { latin: 'BazarKasbkar', persian: 'Ø¨Ø§Ø²Ø§Ø± Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø±', hasPdf: true },
                    { latin: 'SepidarNews', persian: 'Ù¾ÛŒØ§Ù… Ø³Ù¾ÛŒØ¯Ø§Ø±', hasPdf: true },
                    { latin: 'PayameAsalooye', persian: 'Ù¾ÛŒØ§Ù… Ø¹Ø³Ù„ÙˆÛŒÙ‡', hasPdf: true },
                    { latin: 'PayameMa', persian: 'Ù¾ÛŒØ§Ù… Ù…Ø§', hasPdf: true },
                    { latin: 'Pishro', persian: 'Ù¾ÛŒØ´Ø±Ùˆ', hasPdf: true },
                    { latin: 'TejaratOnline', persian: 'ØªØ¬Ø§Ø±Øª', hasPdf: true },
                    { latin: 'Servat', persian: 'Ø«Ø±ÙˆØª', hasPdf: true },
                    { latin: 'JaameJam', persian: 'Ø¬Ø§Ù… Ø¬Ù…', hasPdf: true },
                    { latin: 'Jahan-e-Eghtesad', persian: 'Ø¬Ù‡Ø§Ù† Ø§Ù‚ØªØµØ§Ø¯', hasPdf: true },
                    { latin: 'JahanSanat', persian: 'Ø¬Ù‡Ø§Ù† ØµÙ†Ø¹Øª', hasPdf: true },
                    { latin: 'Javan', persian: 'Ø¬ÙˆØ§Ù†', hasPdf: true },
                    { latin: 'Jomleh', persian: 'Ø¬Ù…Ù„Ù‡', hasPdf: true },
                    { latin: 'JomhouriEslami', persian: 'Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ', hasPdf: true },
                    { latin: 'Khoob', persian: 'Ø®ÙˆØ¨', hasPdf: true },
                    { latin: 'DonyayeEghtesad', persian: 'Ø¯Ù†ÛŒØ§ÛŒ Ø§Ù‚ØªØµØ§Ø¯', hasPdf: true },
                    { latin: 'Roozegar', persian: 'Ø±ÙˆØ²Ú¯Ø§Ø±', hasPdf: true },
                    { latin: 'MadanDaily', persian: 'Ø±ÙˆØ²Ú¯Ø§Ø± Ù…Ø¹Ø¯Ù†', hasPdf: true },
                    { latin: 'Ruydademrouz', persian: 'Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'RooyesheMellat', persian: 'Ø±ÙˆÛŒØ´ Ù…Ù„Øª', hasPdf: true },
                    { latin: 'SetarehSobh', persian: 'Ø³ØªØ§Ø±Ù‡ ØµØ¨Ø­', hasPdf: true },
                    { latin: 'SepehrIranian', persian: 'Ø³Ù¾Ù‡Ø± Ø§ÛŒØ±Ø§Ù†ÛŒØ§Ù†', hasPdf: true },
                    { latin: 'SiasatRuz', persian: 'Ø³ÛŒØ§Ø³Øª Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'Shargh', persian: 'Ø´Ø±Ù‚', hasPdf: true },
                    { latin: 'Shorou', persian: 'Ø´Ø±ÙˆØ¹', hasPdf: true },
                    { latin: 'SobheEmrooz', persian: 'ØµØ¨Ø­ Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'SobhSahel', persian: 'ØµØ¨Ø­ Ø³Ø§Ø­Ù„', hasPdf: true },
                    { latin: 'SedayeEslahat', persian: 'ØµØ¯Ø§ÛŒ Ø§ØµÙ„Ø§Ø­Ø§Øª', hasPdf: true },
                    { latin: 'SedayeIran', persian: 'ØµØ¯Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†', hasPdf: true },
                    { latin: 'GostareshSMT', persian: 'ØµÙ…Øª', hasPdf: true },
                    { latin: 'AsreEsfahan', persian: 'Ø¹ØµØ± Ø§ØµÙÙ‡Ø§Ù†', hasPdf: true },
                    { latin: 'AsreIranian', persian: 'Ø¹ØµØ± Ø§ÛŒØ±Ø§Ù†ÛŒØ§Ù†', hasPdf: true },
                    { latin: 'AsreTosee', persian: 'Ø¹ØµØ± ØªÙˆØ³Ø¹Ù‡', hasPdf: true },
                    { latin: 'AsreRasaneh', persian: 'Ø¹ØµØ± Ø±Ø³Ø§Ù†Ù‡', hasPdf: true },
                    { latin: 'AsrGhanoon', persian: 'Ø¹ØµØ± Ù‚Ø§Ù†ÙˆÙ†', hasPdf: true },
                    { latin: 'Fogholadeh', persian: 'ÙÙˆÙ‚ Ø§Ù„Ø¹Ø§Ø¯Ù‡', hasPdf: true },
                    { latin: 'Ghods', persian: 'Ù‚Ø¯Ø³', hasPdf: true },
                    { latin: 'KarvaKargar', persian: 'Ú©Ø§Ø± Ùˆ Ú©Ø§Ø±Ú¯Ø±', hasPdf: true },
                    { latin: 'KayhanNews', persian: 'Ú©ÛŒÙ‡Ø§Ù†', hasPdf: true },
                    { latin: 'KimiaVatan', persian: 'Ú©ÛŒÙ…ÛŒØ§ÛŒ ÙˆØ·Ù†', hasPdf: true },
                    { latin: 'MardomSalari', persian: 'Ù…Ø±Ø¯Ù… Ø³Ø§Ù„Ø§Ø±ÛŒ', hasPdf: true },
                    { latin: 'Movajehe', persian: 'Ù…ÙˆØ§Ø¬Ù‡Ù‡ Ø§Ù‚ØªØµØ§Ø¯ÛŒ', hasPdf: true },
                    { latin: 'MahdTamadon', persian: 'Ù…Ù‡Ø¯ ØªÙ…Ø¯Ù†', hasPdf: true },
                    { latin: 'NaghshDaily', persian: 'Ù†Ù‚Ø´ Ø§Ù‚ØªØµØ§Ø¯', hasPdf: true },
                    { latin: 'NesfeJahan', persian: 'Ù†ØµÙ Ø¬Ù‡Ø§Ù†', hasPdf: true },
                    { latin: 'HadafEconomic', persian: 'Ù‡Ø¯Ù Ùˆ Ø§Ù‚ØªØµØ§Ø¯', hasPdf: true },
                    { latin: 'Honarmand', persian: 'Ù‡Ù†Ø±Ù…Ù†Ø¯', hasPdf: true },
                    { latin: 'YadegarEmrooz', persian: 'ÛŒØ§Ø¯Ú¯Ø§Ø± Ø§Ù…Ø±ÙˆØ²', hasPdf: true },
                    { latin: 'YaghoutVatan', persian: 'ÛŒØ§Ù‚ÙˆØª ÙˆØ·Ù†', hasPdf: true },
                    { latin: 'AbrarSport', persian: 'Ø§Ø¨Ø±Ø§Ø± ÙˆØ±Ø²Ø´Ù‰', hasPdf: true },
                    { latin: 'KhabarVarzeshi', persian: 'Ø®Ø¨Ø± ÙˆØ±Ø²Ø´ÛŒ', hasPdf: true },
                    { latin: 'Shoot', persian: 'Ø´ÙˆØª', hasPdf: true },
                    { latin: 'Footballs', persian: 'ÙÙˆØªØ¨Ø§Ù„Ø²', hasPdf: true },
                    { latin: 'Gol', persian: 'Ú¯Ù„', hasPdf: true }
                ];

                console.log(`âœ… Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ ${newspapers.length} Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª`);

                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
                newspapersCache[cacheKey] = newspapers;
                return newspapers;

            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª:', error);
                throw new Error('Ø§Ù…Ú©Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
            }
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Øª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡
        function renderNewspaperCard(newspaper, dateFormatted, exists, imageUrl) {
            const { latin, persian, hasPdf } = newspaper;
            const pdfUrl = createPdfUrl(latin, dateFormatted);

            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 col-xl-3';

            if (exists) {
                col.innerHTML = `
                        <div class="card h-100">
                            <div class="position-relative">
                                <img src="${imageUrl}"
                                     class="card-img-top"
                                     alt="${persian}"
                                     loading="lazy"
                                     onerror="handleImageError(this, '${persian}', '${imageUrl}')"
                                     onclick="showImageModal('${imageUrl}', '${persian}')">
                                <span class="position-absolute top-0 start-0 badge available-badge m-2">
                                    <i class="fas fa-check"></i>
                                </span>
                            </div>
                            <div class="card-body text-center d-flex flex-column">
                                <h5 class="card-title mb-1">${persian}</h5>
                                <small class="text-muted mb-2">
                                    <i class="fas fa-calendar me-1"></i>${dateInput.value}
                                </small>
                                <div class="mt-auto">
                                    <button class="btn btn-outline-secondary btn-sm w-100 mb-1"
                                            onclick="showImageModal('${imageUrl}', '${persian}')"
                                            data-bs-toggle="modal"
                                            data-bs-target="#imageModal">
                                        <i class="fas fa-search-plus me-1"></i>Ù†Ù…Ø§ÛŒØ´ Ø¨Ø²Ø±Ú¯
                                    </button>
                                    ${hasPdf ? `
                                    <button class="btn btn-primary btn-sm w-100"
                                            onclick="showPdfModal('${pdfUrl}', '${persian}')">
                                        <i class="fas fa-file-pdf me-1"></i>Ù…Ø´Ø§Ù‡Ø¯Ù‡ PDF
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
            } else {
                col.innerHTML = `
                        <div class="card h-100">
                            <div class="image-placeholder">
                                <div class="text-center">
                                    <i class="fas fa-times-circle fa-2x mb-2 text-muted"></i>
                                    <div class="fw-bold">${persian}</div>
                                    <small class="text-muted">Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡</small>
                                </div>
                            </div>
                            <div class="card-body text-center d-flex flex-column justify-content-center">
                                <h5 class="card-title">${persian}</h5>
                                <p class="text-muted mb-2 small">
                                    Ø§ÛŒÙ† Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
                                </p>
                            </div>
                        </div>
                    `;
            }

            cardsContainer.appendChild(col);
            return col;
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ ØªØµÙˆÛŒØ±
        window.handleImageError = function (img, title, imageUrl) {
            const card = img.closest('.card');
            if (!card) return;

            const placeholder = card.querySelector('.image-placeholder') || document.createElement('div');
            placeholder.className = 'image-placeholder';
            placeholder.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2 text-warning"></i>
                        <div class="fw-bold">${title}</div>
                        <small class="text-muted">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</small>
                    </div>
                `;

            img.style.display = 'none';
            if (!card.querySelector('.image-placeholder')) {
                img.parentElement.appendChild(placeholder);
            }
        };

        // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÛŒØ¹ ØªØµØ§ÙˆÛŒØ± Ø¨Ø§ Ø±ÙˆØ´ Ø¨Ù‡ÛŒÙ†Ù‡
        async function checkImagesQuickly(newspapers, dateFormatted, onProgress) {
            const results = [];
            const total = newspapers.length;

            // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø²Ø±Ú¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø±ÛŒØ¹
            const batchSize = 15; // 15 ØªØµÙˆÛŒØ± Ù‡Ù…Ø²Ù…Ø§Ù†!
            const imagePromises = [];

            for (let i = 0; i < total; i += batchSize) {
                const batch = newspapers.slice(i, i + batchSize);

                // Ø§ÛŒØ¬Ø§Ø¯ promise Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø³ØªÙ‡
                const batchPromise = (async (batchStartIndex) => {
                    const batchPromises = batch.map((newspaper, index) => {
                        const currentIndex = batchStartIndex + index;

                        // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                        if (onProgress && currentIndex % 5 === 0) {
                            setTimeout(() => {
                                onProgress(currentIndex + 1, total);
                            }, 0);
                        }

                        const imageUrl = createCorrectImageUrl(newspaper.latin, dateFormatted);
                        return checkImageExists(imageUrl)
                            .then(exists => ({ newspaper, exists, imageUrl }));
                    });

                    return Promise.all(batchPromises);
                })(i);

                imagePromises.push(batchPromise);

                // ØªÙˆÙ‚Ù Ú©ÙˆØªØ§Ù‡ Ø¨ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
                if (i + batchSize < total) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
            }

            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªÙ…Ø§Ù… Ù†ØªØ§ÛŒØ¬
            const allBatches = await Promise.all(imagePromises);
            allBatches.forEach(batchResults => {
                results.push(...batchResults);
            });

            return results;
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ - Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
        async function loadNewspapers() {
            const dateStr = dateInput.value.trim();

            if (!isValidJalaliDate(dateStr)) {
                alert('âš ï¸ ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.\nÙ…Ø«Ø§Ù„: 1404/10/08');
                dateInput.focus();
                return;
            }

            cardsContainer.innerHTML = '';
            statsEl.innerHTML = '';
            const dateFormatted = formatDate(dateStr);

            statusEl.className = 'loading';
            statusEl.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø±ÛŒØ¹ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§...';

            const startTime = Date.now();

            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§
                const newspapers = await fetchNewspapersOptimized(dateFormatted);

                if (newspapers.length === 0) {
                    throw new Error('Ù‡ÛŒÚ† Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯');
                }

                // Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§
                statusEl.innerHTML = `<i class="fas fa-spinner fa-spin me-2"></i>Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÛŒØ¹ ${newspapers.length} Ø±ÙˆØ²Ù†Ø§Ù…Ù‡...`;

                // Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª
                const progressContainer = document.createElement('div');
                progressContainer.className = 'mb-3';
                progressContainer.innerHTML = `
                        <div class="alert alert-info">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span id="progressText">Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ: 0/${newspapers.length}</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                                     style="width: 0%"></div>
                            </div>
                        </div>
                    `;
                statusEl.parentNode.insertBefore(progressContainer, statusEl.nextSibling);

                let availableCount = 0;
                let unavailableCount = 0;

                // ØªØ§Ø¨Ø¹ Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                const updateProgress = (current, total) => {
                    const progressPercent = Math.round((current / total) * 100);
                    document.getElementById('progressBar').style.width = `${progressPercent}%`;
                    document.getElementById('progressPercent').textContent = `${progressPercent}%`;
                    document.getElementById('progressText').textContent =
                        `Ø¨Ø±Ø±Ø³ÛŒ ØªØµØ§ÙˆÛŒØ±: ${current}/${total}`;
                };

                // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÛŒØ¹ ØªØµØ§ÙˆÛŒØ±
                const imageResults = await checkImagesQuickly(newspapers, dateFormatted, updateProgress);

                // Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ú¯Ø±ÙˆÙ‡ÛŒ
                const renderBatchSize = 20;
                for (let i = 0; i < imageResults.length; i += renderBatchSize) {
                    const batch = imageResults.slice(i, i + renderBatchSize);

                    batch.forEach(result => {
                        const { newspaper, exists, imageUrl } = result;
                        renderNewspaperCard(newspaper, dateFormatted, exists, imageUrl);

                        if (exists) {
                            availableCount++;
                        } else {
                            unavailableCount++;
                        }
                    });

                    // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ UI
                    updateProgress(Math.min(i + renderBatchSize, imageResults.length), imageResults.length);

                    // Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ù‡ÛŒØ¯ UI Ø¨Ø±ÙˆØ² Ø´ÙˆØ¯
                    await new Promise(resolve => setTimeout(resolve, 10));
                }

                // Ø­Ø°Ù Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª
                progressContainer.remove();

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§
                const endTime = Date.now();
                const executionTime = ((endTime - startTime) / 1000).toFixed(1);

                // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø±
                statsEl.innerHTML = `
                        <div class="row">
                            <div class="col-md-3 mb-2">
                                <i class="fas fa-calendar-alt me-2"></i>
                                <strong>ØªØ§Ø±ÛŒØ®:</strong> ${dateStr}
                            </div>
                            <div class="col-md-3 mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <strong>Ù…ÙˆØ¬ÙˆØ¯:</strong> ${availableCount}
                            </div>
                            <div class="col-md-3 mb-2">
                                <i class="fas fa-times-circle text-secondary me-2"></i>
                                <strong>Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯:</strong> ${unavailableCount}
                            </div>
                            <div class="col-md-3 mb-2">
                                <i class="fas fa-clock me-2"></i>
                                <strong>Ø²Ù…Ø§Ù†:</strong> ${executionTime} Ø«Ø§Ù†ÛŒÙ‡
                            </div>
                        </div>
                    `;

                statusEl.className = 'success';
                statusEl.innerHTML = `
                        <i class="fas fa-check-circle me-2"></i>
                        âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯! ${newspapers.length} Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ø¯Ø± ${executionTime} Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯Ù†Ø¯.
                        <div class="mt-2">
                            <span class="text-success">${availableCount} Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡</span> |
                            <span class="text-secondary">${unavailableCount} Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡</span>
                        </div>
                        <div class="mt-2 small">
                            <a href="https://www.pishkhan.com/all?date=${dateFormatted}" target="_blank" class="text-decoration-none">
                                <i class="fas fa-external-link-alt me-1"></i>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ø³Ø§ÛŒØª Ø§ØµÙ„ÛŒ
                            </a>
                        </div>
                    `;

            } catch (error) {
                console.error('Ø®Ø·Ø§:', error);
                statusEl.className = 'error';
                statusEl.innerHTML = `
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Ø®Ø·Ø§: ${error.message}
                        <div class="mt-2 retry-btn">
                            <button class="btn btn-sm btn-outline-warning" onclick="loadNewspapers()">
                                <i class="fas fa-redo me-1"></i>ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
                            </button>
                        </div>
                    `;
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ ØªØµÙˆÛŒØ±
        window.showImageModal = function (imageUrl, title) {
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            const imageContainer = document.getElementById('imageContainer');

            imageContainer.innerHTML = `
                    <div class="text-center">
                        <div class="loading-spinner mb-3" style="width: 40px; height: 40px;"></div>
                        <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±...</div>
                    </div>
                `;

            const img = new Image();
            img.className = 'img-fluid rounded';
            img.style.maxHeight = '80vh';

            img.onload = function () {
                imageContainer.innerHTML = '';
                imageContainer.appendChild(img);
            };

            img.onerror = function () {
                imageContainer.innerHTML = `
                        <div class="text-center">
                            <i class="fas fa-exclamation-triangle fa-4x text-warning mb-3"></i>
                            <h5>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</h5>
                            <p class="text-muted">ØªØµÙˆÛŒØ± "${title}" Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†ÛŒØ³Øª</p>
                            <div class="mt-3">
                                <button class="btn btn-outline-primary"
                                        onclick="window.open('${imageUrl}', '_blank')">
                                    <i class="fas fa-external-link-alt me-1"></i>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ…
                                </button>
                            </div>
                        </div>
                    `;
            };

            img.src = imageUrl + '?t=' + Date.now();
            document.getElementById('imageModalLabel').textContent = title;

            modal.show();
        };

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ PDF
        // ØªØ§Ø¨Ø¹ Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ PDF
        async function verifyPdfExists(pdfUrl) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ paper Ùˆ date Ø§Ø² URL
            const url = new URL(pdfUrl);
            const paper = url.searchParams.get('paper');
            const date = url.searchParams.get('date');

            if (!paper || !date) return false;

            try {
                const workerUrl = `https://your-worker.your-subdomain.workers.dev/?paper=${paper}&date=${date}`;
                const res = await fetch(workerUrl);
                const data = await res.json();
                return data.hasPdf === true;
            } catch (err) {
                console.warn('Worker check failed, falling back to image check:', err);
                return false;
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ù†Ù…Ø§ÛŒØ´ PDF
        window.showPdfModal = async function (pdfUrl, title) {
            const modal = new bootstrap.Modal(document.getElementById('pdfModal'));
            const frame = document.getElementById('pdfFrame');
            const countdownEl = document.getElementById('countdownContainer');

            document.getElementById('pdfModalLabel').textContent = title;

            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø§ÙˆÙ„ÛŒÙ‡
            countdownEl.classList.remove('hidden');
            countdownEl.innerHTML = `
        <div class="text-center">
            <div class="loading-spinner mb-2" style="width: 30px; height: 30px; margin: 0 auto;"></div>
            <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ PDF...</div>
        </div>
    `;

            modal.show();

            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ PDF
            const pdfExists = await verifyPdfExists(pdfUrl);

            if (!pdfExists) {
                countdownEl.innerHTML = `
            <div class="alert alert-warning text-center">
                <i class="fas fa-file-excel fa-2x mb-3 text-warning"></i>
                <h5>ÙØ§ÛŒÙ„ PDF ÛŒØ§ÙØª Ù†Ø´Ø¯</h5>
                <p class="mb-2">ÙØ§ÛŒÙ„ PDF Ø±ÙˆØ²Ù†Ø§Ù…Ù‡ "${title}" Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</p>
                <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm me-2"
                            onclick="window.open('${pdfUrl}', '_blank')">
                        <i class="fas fa-external-link-alt me-1"></i>Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªÛŒ
                    </button>
                    <button class="btn btn-outline-secondary btn-sm"
                            data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Ø¨Ø³ØªÙ†
                    </button>
                </div>
            </div>
        `;
                frame.src = '';
                return;
            }

            // Ø§Ú¯Ø± PDF Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡
            countdownEl.innerHTML = `
        <div class="text-center">
            <i class="fas fa-check-circle fa-2x mb-3 text-success"></i>
            <div>ÙØ§ÛŒÙ„ PDF Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª</div>
            <div class="small text-muted">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
        </div>
    `;

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ PDF Ø¨Ø§ timeout
            const timestampedUrl = pdfUrl + (pdfUrl.includes('?') ? '&' : '?') + 't=' + Date.now();
            frame.src = timestampedUrl;

            let loaded = false;
            let sec = 10;

            const updateUI = () => {
                if (!loaded) {
                    countdownEl.innerHTML = `
                <div class="text-center">
                    <div class="loading-spinner mb-2" style="width: 20px; height: 20px; margin: 0 auto;"></div>
                    <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ PDF</div>
                    <div class="small text-muted">${sec} Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡</div>
                </div>
            `;
                    sec--;

                    if (sec < 0) {
                        // Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡ØŒ ÙØ±Ø¶ Ú©Ù† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
                        loaded = true;
                        countdownEl.classList.add('hidden');
                        frame.classList.add('loaded');
                    }
                }
            };

            updateUI();
            const timer = setInterval(updateUI, 1000);

            // ÙˆÙ‚ØªÛŒ iframe Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
            frame.onload = function () {
                if (!loaded) {
                    loaded = true;
                    clearInterval(timer);
                    countdownEl.classList.add('hidden');
                    frame.classList.add('loaded');
                }
            };

            // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
            frame.onerror = function () {
                clearInterval(timer);
                countdownEl.classList.remove('hidden');
                countdownEl.innerHTML = `
            <div class="alert alert-danger text-center">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ PDF
            </div>
        `;
            };

            // Ø±ÛŒØ³Øª Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù†
            const modalElement = document.getElementById('pdfModal');
            const resetModal = () => {
                clearInterval(timer);
                frame.src = '';
                frame.classList.remove('loaded');
                countdownEl.classList.remove('hidden');
                countdownEl.innerHTML = `<i class="fas fa-hourglass-half me-2"></i><span>Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</span>`;
                modalElement.removeEventListener('hidden.bs.modal', resetModal);
            };

            modalElement.addEventListener('hidden.bs.modal', resetModal);
        };
        // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
        dateInput.addEventListener('change', loadNewspapers);
        dateInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') loadNewspapers();
        });

        // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ø³Ø±ÛŒØ¹
        function addQuickDateButtons() {
            const container = document.createElement('div');
            container.className = 'd-flex justify-content-center gap-2 mt-3 flex-wrap';

            const dates = [
                { label: 'ğŸš€ Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ†', date: '1404/10/08' },
                { label: 'ğŸ“… Ø§Ù…Ø±ÙˆØ²', date: getTodayJalali() },
                { label: 'ğŸ“… Ø¯ÛŒØ±ÙˆØ²', date: getYesterdayJalali() },
                { label: 'ğŸ‰ Ø§ÙˆÙ„ Ø³Ø§Ù„', date: '1404/01/01' },
                { label: 'ğŸ§ª Ø¢Ø²Ù…Ø§ÛŒØ´', date: '1403/12/29' }
            ];

            dates.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-outline-success btn-sm';
                btn.innerHTML = `${item.label}`;
                btn.onclick = () => {
                    dateInput.value = item.date;
                    loadNewspapers();
                };
                container.appendChild(btn);
            });

            dateInput.parentNode.parentNode.appendChild(container);
        }

        // ØªÙˆØ§Ø¨Ø¹ ØªØ§Ø±ÛŒØ®
        function getTodayJalali() {
            const today = new Date();
            const jalaliYear = 1403 + (today.getFullYear() - 2024);
            const month = today.getMonth() + 1;
            const day = today.getDate();
            return `${jalaliYear}/${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;
        }

        function getYesterdayJalali() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const jalaliYear = 1403 + (yesterday.getFullYear() - 2024);
            const month = yesterday.getMonth() + 1;
            const day = yesterday.getDate();
            return `${jalaliYear}/${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function () {
            addQuickDateButtons();
            setTimeout(() => loadNewspapers(), 300);
        };
    </script>

</body>
</html>